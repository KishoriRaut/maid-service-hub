<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Maid Profile - City Maid Services</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        poppins: ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        brand: {
                            primary: '#4F46E5',
                            secondary: '#4338CA',
                            light: '#EEF2FF',
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .section-title {
                @apply relative inline-block pb-4;
            }

            .section-title::after {
                content: '';
                @apply absolute bottom-0 left-1/2 -translate-x-1/2 w-20 h-[3px] bg-gradient-to-r from-brand-primary to-brand-secondary rounded-sm;
            }

            .badge {
                @apply bg-gradient-to-r from-brand-primary to-brand-secondary px-4 py-2 rounded-full text-white font-medium text-sm leading-5;
            }

            .truncate-2 {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
                @apply overflow-hidden;
            }

            .form-input {
                @apply mt-1 block w-full rounded-lg border-gray-300 shadow-sm focus:border-brand-primary focus:ring-brand-primary transition-all duration-200;
            }

            .form-label {
                @apply block text-sm font-medium text-gray-700 mb-1;
            }

            .form-hint {
                @apply mt-1 text-sm text-gray-500;
            }

            .form-section {
                @apply space-y-4 bg-white p-6 rounded-lg shadow-sm border border-gray-100;
            }

            .form-section-title {
                @apply text-lg font-semibold text-gray-900 flex items-center gap-2 pb-2 border-b border-gray-200;
            }

            .input-group {
                @apply relative;
            }

            .input-icon {
                @apply absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none text-gray-400;
            }

            .input-with-icon {
                @apply pl-10;
            }

            .checkbox-group {
                @apply flex flex-wrap gap-3 p-3 bg-gray-50 rounded-lg;
            }

            .checkbox-label {
                @apply inline-flex items-center px-3 py-2 rounded-md bg-white border border-gray-200 hover:border-brand-primary transition-colors duration-200;
            }

            .checkbox-input {
                @apply rounded border-gray-300 text-brand-primary shadow-sm focus:border-brand-primary focus:ring-brand-primary;
            }

            .validation-message {
                @apply text-sm mt-1;
            }

            .validation-message.error {
                @apply text-red-600;
            }

            .validation-message.success {
                @apply text-green-600;
            }
        }
    </style>
</head>
<body class="font-poppins bg-gray-100 min-h-screen">
    <!-- Navigation Bar -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-20">
                <div class="flex items-center">
                    <a href="../index.html" class="text-3xl font-bold text-brand-primary tracking-tight">City<span class="text-brand-secondary"> Maid Services</span></a>
                </div>
                <!-- Mobile menu button -->
                <div class="flex items-center md:hidden">
                    <button id="mobileMenuBtn" class="text-gray-700 hover:text-brand-primary focus:outline-none" aria-label="Open menu">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
                <!-- Desktop menu -->
                <div class="hidden md:flex items-center space-x-6">
                    <a href="../index.html" class="text-gray-700 hover:text-brand-primary font-medium transition-colors">Home</a>
                    <a href="../static/contact.html" class="text-gray-700 hover:text-brand-primary font-medium transition-colors">Contact Us</a>
                    <a href="../static/about.html" class="text-gray-700 hover:text-brand-primary font-medium transition-colors">About Us</a>
                    <a href="../auth/login.html" class="bg-brand-primary text-white px-6 py-3 rounded-lg hover:bg-brand-secondary font-semibold transition-colors">Sign In</a>
                </div>
            </div>
        </div>
        <!-- Mobile menu panel -->
        <div id="mobileMenu" class="hidden md:hidden fixed inset-0 bg-black bg-opacity-50 z-50">
            <div class="fixed inset-y-0 right-0 max-w-xs w-full bg-white shadow-xl">
                <div class="flex items-center justify-between p-4 border-b">
                    <div class="flex items-center space-x-4">
                        <button onclick="window.history.back()" class="text-gray-500 hover:text-gray-700" aria-label="Go back">
                            <i class="fas fa-arrow-left text-xl"></i>
                        </button>
                        <a href="../index.html" class="text-gray-500 hover:text-gray-700" aria-label="Go to homepage">
                            <i class="fas fa-home text-xl"></i>
                        </a>
                    </div>
                    <h2 class="text-xl font-semibold text-gray-900">Menu</h2>
                    <button id="closeMobileMenu" class="text-gray-500 hover:text-gray-700" aria-label="Close menu">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <div class="p-4 space-y-4">
                    <a href="../index.html" class="block text-gray-700 hover:text-brand-primary py-2">Home</a>
                    <a href="../static/contact.html" class="block text-gray-700 hover:text-brand-primary py-2">Contact Us</a>
                    <a href="../static/about.html" class="block text-gray-700 hover:text-brand-primary py-2">About Us</a>
                    <a href="../auth/login.html" class="block bg-brand-primary text-white px-6 py-3 rounded-lg hover:bg-brand-secondary text-center font-semibold mt-4">Sign In</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <div class="bg-brand-light py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-extrabold tracking-tight text-gray-900 sm:text-4xl">
                        Create Your Maid Profile
                    </h1>
                    <p class="mt-2 text-base text-gray-600">
                        Fill in your details to create your professional profile
                    </p>
                </div>
                <a href="../index.html" class="inline-flex items-center text-brand-primary hover:text-brand-secondary font-medium">
                    <i class="fas fa-home mr-2"></i>
                    Back to Home
                </a>
            </div>
        </div>
    </div>

    <main class="max-w-7xl mx-auto py-8 sm:px-6 lg:px-8">
        <div class="bg-white shadow-md rounded-lg overflow-hidden">
            <form id="maidProfileForm" class="p-6 space-y-8">
                <!-- Profile Image Upload -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="ri-user-smile-line text-brand-primary text-xl"></i>
                        Profile Photo
                    </h3>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <img id="profileImagePreview" src="https://via.placeholder.com/150" alt="Profile Preview" class="h-32 w-32 rounded-full object-cover border-4 border-brand-light shadow-lg">
                            <input type="file" id="profileImage" accept="image/*" class="hidden" title="Upload profile photo" aria-label="Upload profile photo">
                            <button type="button" onclick="document.getElementById('profileImage').click()" class="absolute bottom-0 right-0 bg-brand-primary text-white p-2 rounded-full shadow-lg hover:bg-brand-secondary transition-colors duration-200" title="Upload profile photo" aria-label="Upload profile photo">
                                <i class="ri-camera-line"></i>
                            </button>
                        </div>
                        <div>
                            <p class="form-hint">Upload a clear, professional photo of yourself</p>
                            <p class="text-xs text-gray-400">Recommended size: 500x500px, Max size: 2MB</p>
                            <div id="profileImageValidation" class="validation-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="ri-user-heart-line text-brand-primary text-xl"></i>
                        Personal Information
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="fullName" class="form-label">Full Name</label>
                            <div class="input-icon">
                                <i class="ri-user-line"></i>
                            </div>
                            <input type="text" id="fullName" name="fullName" required 
                                class="form-input input-with-icon"
                                placeholder="Enter your full name"
                                pattern="[A-Za-z\s]{2,}"
                                title="Name should contain only letters and spaces (minimum 2 characters)">
                            <div id="fullNameValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="phoneNumber" class="form-label">Phone Number</label>
                            <div class="input-icon">
                                <i class="ri-smartphone-line"></i>
                            </div>
                            <input type="tel" id="phoneNumber" name="phoneNumber" required 
                                class="form-input input-with-icon"
                                placeholder="98XXXXXXXX"
                                pattern="[0-9]{10}"
                                title="Please enter a valid 10-digit phone number">
                            <div id="phoneValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="email" class="form-label">Email</label>
                            <div class="input-icon">
                                <i class="ri-mail-line"></i>
                            </div>
                            <input type="email" id="email" name="email" required 
                                class="form-input input-with-icon"
                                placeholder="your.email@example.com">
                            <div id="emailValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="age" class="form-label">Age</label>
                            <div class="input-icon">
                                <i class="ri-calendar-user-line"></i>
                            </div>
                            <input type="number" id="age" name="age" min="18" max="100" required 
                                class="form-input input-with-icon"
                                placeholder="Enter your age">
                            <div id="ageValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="city" class="form-label">City</label>
                            <div class="input-icon">
                                <i class="ri-building-2-line"></i>
                            </div>
                            <input type="text" id="city" name="city" required 
                                class="form-input input-with-icon"
                                placeholder="Enter your city name">
                            <div id="cityValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="area" class="form-label">Area/Tole Name</label>
                            <div class="input-icon">
                                <i class="ri-map-pin-line"></i>
                            </div>
                            <input type="text" id="area" name="area" required 
                                class="form-input input-with-icon"
                                placeholder="Enter your area and tole name">
                            <div id="areaValidation" class="validation-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Professional Details Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="ri-briefcase-3-line text-brand-primary text-xl"></i>
                        Professional Details
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="input-group">
                            <label for="gender" class="form-label">Gender</label>
                            <div class="input-icon">
                                <i class="ri-user-settings-line"></i>
                            </div>
                            <select id="gender" name="gender" required class="form-input input-with-icon">
                                <option value="">Select gender</option>
                                <option value="female">Female</option>
                                <option value="male">Male</option>
                                <option value="other">Other</option>
                            </select>
                            <div id="genderValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="religion" class="form-label">Religion</label>
                            <div class="input-icon">
                                <i class="ri-heart-line"></i>
                            </div>
                            <select id="religion" name="religion" class="form-input input-with-icon">
                                <option value="">Select religion</option>
                                <option value="hinduism">Hinduism</option>
                                <option value="buddhism">Buddhism</option>
                                <option value="christianity">Christianity</option>
                                <option value="islam">Islam</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="workType" class="form-label">Work Type</label>
                            <div class="input-icon">
                                <i class="ri-time-line"></i>
                            </div>
                            <select id="workType" name="workType" required class="form-input input-with-icon">
                                <option value="">Select work type</option>
                                <option value="part_time">Part Time</option>
                                <option value="full_time">Full Time</option>
                                <option value="24hours">24 Hours</option>
                                <option value="couple">As a Couple/Wife-Husband Both</option>
                            </select>
                            <div id="workTypeValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="experienceYears" class="form-label">Years of Experience</label>
                            <div class="input-icon">
                                <i class="ri-star-line"></i>
                            </div>
                            <select id="experienceYears" name="experienceYears" required class="form-input input-with-icon">
                                <option value="">Select experience</option>
                                <option value="fresher">Fresher</option>
                                <option value="1+">1+ years</option>
                                <option value="2+">2+ years</option>
                                <option value="3+">3+ years</option>
                                <option value="4+">4+ years</option>
                                <option value="5+">5+ years</option>
                                <option value="10+">More than 10 years</option>
                            </select>
                            <div id="experienceValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="workingTime" class="form-label">Working Time</label>
                            <div class="input-icon">
                                <i class="ri-calendar-line"></i>
                            </div>
                            <select id="workingTime" name="workingTime" required class="form-input input-with-icon">
                                <option value="">Select working time</option>
                                <option value="morning">Morning (6AM-10AM)</option>
                                <option value="day">Day (10AM-6PM)</option>
                                <option value="evening">Evening (3PM-7PM)</option>
                                <option value="night">Night (7PM-7AM)</option>
                                <option value="24hours">24 Hours/Homestay</option>
                                <option value="flexible">Flexible Working Time</option>
                            </select>
                            <div id="workingTimeValidation" class="validation-message"></div>
                        </div>
                        <div class="input-group">
                            <label for="salaryRange" class="form-label">Salary Range</label>
                            <div class="input-icon">
                                <i class="ri-money-dollar-circle-line"></i>
                            </div>
                            <select id="salaryRange" name="salaryRange" required class="form-input input-with-icon">
                                <option value="">Select salary range</option>
                                <option value="6000-10000">6,000 - 10,000 NPR</option>
                                <option value="10000-15000">10,000 - 15,000 NPR</option>
                                <option value="15000-20000">15,000 - 20,000 NPR</option>
                                <option value="20000-25000">20,000 - 25,000 NPR</option>
                                <option value="25000-30000">25,000 - 30,000 NPR</option>
                                <option value="30000+">30,000+ NPR</option>
                            </select>
                            <div id="salaryValidation" class="validation-message"></div>
                        </div>
                    </div>
                </div>

                <!-- Skills & Preferences Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="ri-tools-line text-brand-primary text-xl"></i>
                        Skills & Preferences
                    </h3>
                    <!-- Languages -->
                    <div class="space-y-2">
                        <label class="form-label">Languages</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="nepali" class="checkbox-input">
                                <span class="ml-2">Nepali</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="english" class="checkbox-input">
                                <span class="ml-2">English</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="hindi" class="checkbox-input">
                                <span class="ml-2">Hindi</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="maithili" class="checkbox-input">
                                <span class="ml-2">Maithili</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="bhojpuri" class="checkbox-input">
                                <span class="ml-2">Bhojpuri</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="languages" value="others" class="checkbox-input">
                                <span class="ml-2">Others</span>
                            </label>
                        </div>
                        <div id="languagesValidation" class="validation-message"></div>
                    </div>

                    <!-- Skills -->
                    <div class="space-y-2 mt-4">
                        <label class="form-label">Skills</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="cleaning" class="checkbox-input">
                                <span class="ml-2">Cleaning</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="laundry" class="checkbox-input">
                                <span class="ml-2">Laundry</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="cooking" class="checkbox-input">
                                <span class="ml-2">Cooking</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="childcare" class="checkbox-input">
                                <span class="ml-2">Childcare</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="elderly_care" class="checkbox-input">
                                <span class="ml-2">Elderly Care</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="pet_care" class="checkbox-input">
                                <span class="ml-2">Pet Care</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="gardening" class="checkbox-input">
                                <span class="ml-2">Gardening</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="ironing" class="checkbox-input">
                                <span class="ml-2">Ironing</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="driving" class="checkbox-input">
                                <span class="ml-2">Driving</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="office_cleaning" class="checkbox-input">
                                <span class="ml-2">Office Cleaning</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="postnatal_massage" class="checkbox-input">
                                <span class="ml-2">Postnatal/Sutkeri Oil Massage</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="patient_care" class="checkbox-input">
                                <span class="ml-2">Patient Care</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="shopping" class="checkbox-input">
                                <span class="ml-2">Shopping</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="skills" value="child_tutoring" class="checkbox-input">
                                <span class="ml-2">Child Tutoring</span>
                            </label>
                        </div>
                        <div id="skillsValidation" class="validation-message"></div>
                    </div>

                    <!-- Availability -->
                    <div class="space-y-2 mt-4">
                        <label class="form-label">Availability</label>
                        <div class="checkbox-group">
                            <label class="checkbox-label">
                                <input type="checkbox" name="availability" value="once_a_week" class="checkbox-input">
                                <span class="ml-2">Once a Week</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="availability" value="twice_a_week" class="checkbox-input">
                                <span class="ml-2">Twice a Week</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="availability" value="thrice_a_week" class="checkbox-input">
                                <span class="ml-2">Thrice a Week</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="availability" value="six_days_a_week" class="checkbox-input">
                                <span class="ml-2">6 Days a Week</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="availability" value="seven_days_a_week" class="checkbox-input">
                                <span class="ml-2">7 Days a Week</span>
                            </label>
                        </div>
                        <div id="availabilityValidation" class="validation-message"></div>
                    </div>
                </div>

                <!-- Bio Section -->
                <div class="form-section">
                    <h3 class="form-section-title">
                        <i class="ri-edit-line text-brand-primary text-xl"></i>
                        About You
                    </h3>
                    <div>
                        <label for="bio" class="form-label">Tell us about yourself</label>
                        <textarea id="bio" name="bio" rows="4" 
                            class="form-input"
                            placeholder="Tell employers about yourself, your experience, and what makes you a great maid..."
                            minlength="50"
                            maxlength="200"></textarea>
                        <div class="form-hint">Minimum 50 characters, maximum 200 characters</div>
                        <div id="bioValidation" class="validation-message"></div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="pt-4">
                    <button type="submit" class="w-full bg-brand-primary text-white py-3 px-6 rounded-lg hover:bg-brand-secondary focus:outline-none focus:ring-2 focus:ring-brand-primary focus:ring-offset-2 transition-all duration-300 flex items-center justify-center gap-2">
                        <i class="ri-check-double-line"></i>
                        Create Profile
                    </button>
                </div>
            </form>
        </div>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            try {
                console.log('DOM loaded, initializing...');
                
                // Check if Supabase client is properly initialized
                if (!window.supabase) {
                    console.error('Supabase client not initialized');
                    throw new Error('Database connection error. Please try again later.');
                }
                
                // Check if user is already logged in
                const { data: { session }, error } = await window.supabase.auth.getSession();
                if (error) {
                    console.error('Error getting session:', error);
                    throw error;
                }
                
                if (!session) {
                    window.location.href = 'login.html';
                    return;
                }
                
                // Check if user already has a maid profile
                const { data: profile, error: profileError } = await window.supabase
                    .from('maid_profiles')
                    .select('id')
                    .eq('user_id', session.user.id)
                    .single();
                
                if (profile) {
                    window.location.href = '../dashboard/maid/dashboard.html';
                }
                
                // Form validation functions
                function validateFullName(name) {
                    const regex = /^[A-Za-z\s]{2,}$/;
                    return regex.test(name);
                }

                function validatePhone(phone) {
                    const regex = /^[0-9]{10}$/;
                    return regex.test(phone);
                }

                function validateEmail(email) {
                    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return regex.test(email);
                }

                function validateAge(age) {
                    return age >= 18 && age <= 100;
                }

                function validateRequired(value) {
                    return value && value.trim() !== '';
                }

                function validateCheckboxes(name, minCount = 1) {
                    const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
                    return checkboxes.length >= minCount;
                }

                // Handle profile image upload
                document.getElementById('profileImage').addEventListener('change', function(e) {
                    const file = e.target.files[0];
                    const validationDiv = document.getElementById('profileImageValidation');
                    
                    if (file) {
                        // Validate file size (max 2MB)
                        if (file.size > 2 * 1024 * 1024) {
                            validationDiv.textContent = 'Image size should be less than 2MB';
                            validationDiv.className = 'validation-message error';
                            e.target.value = '';
                            return;
                        }

                        // Validate file type
                        if (!file.type.startsWith('image/')) {
                            validationDiv.textContent = 'Please upload an image file';
                            validationDiv.className = 'validation-message error';
                            e.target.value = '';
                            return;
                        }

                        const reader = new FileReader();
                        reader.onload = function(e) {
                            document.getElementById('profileImagePreview').src = e.target.result;
                            validationDiv.textContent = 'Image uploaded successfully';
                            validationDiv.className = 'validation-message success';
                        }
                        reader.readAsDataURL(file);
                    }
                });
                
                // Handle form submission
                document.getElementById('maidProfileForm').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    try {
                        // Get current user
                        const { data: { session }, error: sessionError } = await window.supabase.auth.getSession();
                        if (sessionError) {
                            console.error('Session error:', sessionError);
                            alert('Authentication error. Please log in again.');
                            window.location.href = 'login.html';
                            return;
                        }
                        
                        if (!session) {
                            alert('You must be logged in to create a profile.');
                            window.location.href = 'login.html';
                            return;
                        }
                        
                        const userId = session.user.id;
                        console.log('User ID:', userId);
                        
                        // Validate form fields
                        const fullName = document.getElementById('fullName').value;
                        const phoneNumber = document.getElementById('phoneNumber').value;
                        const email = document.getElementById('email').value;
                        const age = parseInt(document.getElementById('age').value);
                        const gender = document.getElementById('gender').value;
                        const religion = document.getElementById('religion').value;
                        const city = document.getElementById('city').value;
                        const area = document.getElementById('area').value;
                        const workType = document.getElementById('workType').value;
                        const experienceYears = document.getElementById('experienceYears').value;
                        const workingTime = document.getElementById('workingTime').value;
                        const salaryRange = document.getElementById('salaryRange').value;
                        const bio = document.getElementById('bio').value;
                        
                        // Validate required fields
                        if (!fullName || !phoneNumber || !email || !age || !gender || !city || !area || !workType || !experienceYears || !workingTime || !salaryRange) {
                            alert('Please fill in all required fields.');
                            return;
                        }
                        
                        // Get selected languages
                        const languagesCheckboxes = document.querySelectorAll('input[name="languages"]:checked');
                        const languages = Array.from(languagesCheckboxes).map(cb => cb.value);
                        
                        if (languages.length === 0) {
                            alert('Please select at least one language.');
                            return;
                        }
                        
                        // Get selected skills
                        const skillsCheckboxes = document.querySelectorAll('input[name="skills"]:checked');
                        const skills = Array.from(skillsCheckboxes).map(cb => cb.value);
                        
                        if (skills.length === 0) {
                            alert('Please select at least one skill.');
                            return;
                        }
                        
                        // Get availability
                        const availabilityCheckboxes = document.querySelectorAll('input[name="availability"]:checked');
                        const availability = Array.from(availabilityCheckboxes).map(cb => cb.value);
                        
                        if (availability.length === 0) {
                            alert('Please select at least one availability option.');
                            return;
                        }
                        
                        // Handle profile image upload
                        let profilePhotoUrl = null;
                        const profileImageFile = document.getElementById('profileImage').files[0];
                        
                        if (profileImageFile) {
                            try {
                                console.log('Uploading maid profile image...');
                                
                                // Use a simpler approach with a more basic file path
                                const fileExt = profileImageFile.name.split('.').pop();
                                const fileName = `${userId}.${fileExt}`;
                                
                                console.log('File name:', fileName);
                                console.log('File type:', profileImageFile.type);
                                console.log('File size:', profileImageFile.size);
                                
                                // Try to upload to the 'maid_profile_photos' bucket
                                const { data, error: uploadError } = await window.supabase.storage
                                    .from('maid_profile_photos')
                                    .upload(fileName, profileImageFile, {
                                        cacheControl: '3600',
                                        upsert: true
                                    });
                                
                                if (uploadError) {
                                    console.error('Error uploading image:', uploadError);
                                    console.error('Error details:', JSON.stringify(uploadError));
                                    
                                    // Try a different approach - upload to a folder structure
                                    console.log('Trying alternative upload approach...');
                                    
                                    const folderPath = `${userId}/${fileName}`;
                                    console.log('Alternative path:', folderPath);
                                    
                                    const { data: altData, error: altUploadError } = await window.supabase.storage
                                        .from('maid_profile_photos')
                                        .upload(folderPath, profileImageFile, {
                                            cacheControl: '3600',
                                            upsert: true
                                        });
                                    
                                    if (altUploadError) {
                                        console.error('Alternative upload also failed:', altUploadError);
                                        throw altUploadError;
                                    }
                                    
                                    console.log('Alternative upload succeeded');
                                    
                                    const { data: { publicUrl } } = window.supabase.storage
                                        .from('maid_profile_photos')
                                        .getPublicUrl(folderPath);
                                    
                                    profilePhotoUrl = publicUrl;
                                } else {
                                    console.log('Image uploaded successfully');
                                    
                                    const { data: { publicUrl } } = window.supabase.storage
                                        .from('maid_profile_photos')
                                        .getPublicUrl(fileName);
                                    
                                    profilePhotoUrl = publicUrl;
                                }
                                
                                console.log('Public URL:', profilePhotoUrl);
                            } catch (uploadError) {
                                console.error('Error handling maid profile image:', uploadError);
                                console.error('Full error details:', JSON.stringify(uploadError));
                                
                                // Try one more approach - direct upload without any path manipulation
                                try {
                                    console.log('Trying direct upload approach...');
                                    
                                    const { data, error: directUploadError } = await window.supabase.storage
                                        .from('maid_profile_photos')
                                        .upload(profileImageFile.name, profileImageFile);
                                    
                                    if (directUploadError) {
                                        console.error('Direct upload also failed:', directUploadError);
                                        alert('Error uploading profile image. Please try again or continue without an image.');
                                    } else {
                                        console.log('Direct upload succeeded');
                                        
                                        const { data: { publicUrl } } = window.supabase.storage
                                            .from('maid_profile_photos')
                                            .getPublicUrl(profileImageFile.name);
                                        
                                        profilePhotoUrl = publicUrl;
                                        console.log('Public URL from direct upload:', profilePhotoUrl);
                                    }
                                } catch (directError) {
                                    console.error('Direct upload error:', directError);
                                    alert('Error uploading profile image. Please try again or continue without an image.');
                                }
                            }
                        }
                        
                        // Get selected experience value
                        const experienceValue = document.getElementById('experienceYears').value;
                        console.log('Selected experience value:', experienceValue);
                        
                        // Make sure we're using the exact string value from the dropdown
                        // The database constraint expects these exact values: 'fresher', '1+', '2+', etc.
                        if (!['fresher', '1+', '2+', '3+', '4+', '5+', '10+'].includes(experienceValue)) {
                            console.error('Invalid experience value:', experienceValue);
                            alert('Please select a valid experience value from the dropdown.');
                            return;
                        }
                        
                        console.log('Using experience value for database:', experienceValue);
                        
                        // Create maid profile in database
                        console.log('Creating maid profile in database...');
                        
                        // First, let's try to get the current user's profile to see if it exists
                        const { data: existingProfile, error: profileError } = await window.supabase
                            .from('maid_profiles')
                            .select('*')
                            .eq('user_id', userId)
                            .single();
                            
                        if (profileError && !profileError.message.includes('No rows found')) {
                            console.error('Error checking existing profile:', profileError);
                        }
                        
                        if (existingProfile) {
                            console.log('User already has a profile:', existingProfile);
                            alert('You already have a maid profile. Please update your existing profile instead.');
                            window.location.href = '../dashboard/maid/edit-profile.html';
                            return;
                        }
                        
                        // Try to insert with a simpler approach - just the essential fields first
                        try {
                            console.log('Attempting to insert profile with minimal fields...');
                            
                            const minimalProfileData = {
                                user_id: userId,
                                full_name: fullName,
                                phone_number: phoneNumber,
                                email: email,
                                age: age,
                                gender: gender,
                                city: city,
                                area: area,
                                work_type: workType,
                                experience: experienceValue, // Use the original string value
                                working_time: workingTime,
                                salary_range: salaryRange
                            };
                            
                            console.log('Minimal profile data:', minimalProfileData);
                            
                            const { data, error } = await window.supabase
                                .from('maid_profiles')
                                .insert([minimalProfileData]);
                                
                            if (error) {
                                console.error('Error inserting minimal profile:', error);
                                throw error;
                            }
                            
                            console.log('Minimal profile inserted successfully:', data);
                            
                            // Now try to update with the additional fields
                            const { data: updateData, error: updateError } = await window.supabase
                                .from('maid_profiles')
                                .update({
                                    religion: religion,
                                    profile_photo: profilePhotoUrl,
                                    languages: languages,
                                    skills: skills,
                                    availability: availability,
                                    bio: bio
                                })
                                .eq('user_id', userId);
                                
                            if (updateError) {
                                console.error('Error updating profile with additional fields:', updateError);
                                // Continue anyway since the basic profile was created
                            } else {
                                console.log('Profile updated with additional fields:', updateData);
                            }
                            
                            // Redirect to maid dashboard
                            window.location.href = '../dashboard/maid/dashboard.html';
                            
                        } catch (error) {
                            console.error('Error in profile creation process:', error);
                            alert(`Error creating profile: ${error.message}`);
                        }
                        
                    } catch (error) {
                        console.error('Error creating profile:', error);
                        alert(`An error occurred while creating your profile: ${error.message}`);
                    }
                });
                
                // Mobile menu toggle
                const mobileMenuBtn = document.getElementById('mobileMenuBtn');
                const closeMobileMenu = document.getElementById('closeMobileMenu');
                const mobileMenu = document.getElementById('mobileMenu');

                if (mobileMenuBtn && closeMobileMenu && mobileMenu) {
                    mobileMenuBtn.addEventListener('click', function() {
                        mobileMenu.classList.remove('hidden');
                    });

                    closeMobileMenu.addEventListener('click', function() {
                        mobileMenu.classList.add('hidden');
                    });
                }
            } catch (error) {
                console.error('Error initializing page:', error);
                alert('An error occurred while loading the page. Please try again.');
            }
        });
    </script>
</body>
</html> 