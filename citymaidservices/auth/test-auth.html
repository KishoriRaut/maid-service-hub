<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Authentication - City Maid Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white rounded-lg shadow-lg p-8">
        <h1 class="text-2xl font-bold mb-6">Supabase Authentication Test</h1>
        
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Connection Test</h2>
            <button id="testConnection" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                Test Connection
            </button>
            <div id="connectionResult" class="mt-2 p-2 rounded"></div>
        </div>
        
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Authentication Test</h2>
            <div class="grid grid-cols-1 gap-4">
                <div>
                    <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="email" name="email" placeholder="Enter your email" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <div>
                    <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="password" name="password" placeholder="Enter your password" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
                </div>
                <button id="testAuth" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Test Authentication
                </button>
            </div>
            <div id="authResult" class="mt-2 p-2 rounded"></div>
        </div>
        
        <div class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Profile Test</h2>
            <button id="testProfile" class="bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600">
                Test Profile Access
            </button>
            <div id="profileResult" class="mt-2 p-2 rounded"></div>
        </div>
        
        <div class="mt-6">
            <a href="login.html" class="text-blue-500 hover:underline">Back to Login</a>
        </div>
    </div>

    <script>
        // Wait for the page to load
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize Supabase client
            const supabaseUrl = 'https://fdgqqxyyofjnkhswkwcq.supabase.co';
            const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkZ3FxeHl5b2Zqbmtoc3drd2NxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjQyMTMsImV4cCI6MjA1OTYwMDIxM30.YyJLLu3r2a7Mh7ny0ie-YzzLfPh5PdrJJHnBFBxWqVE';
            
            // Create the Supabase client
            const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);
            
            // Test connection
            document.getElementById('testConnection').addEventListener('click', async function() {
                const resultDiv = document.getElementById('connectionResult');
                resultDiv.textContent = 'Testing connection...';
                resultDiv.className = 'mt-2 p-2 rounded bg-gray-100';
                
                try {
                    const { data, error } = await supabaseClient.from('profiles').select('count').limit(1);
                    
                    if (error) {
                        throw error;
                    }
                    
                    resultDiv.textContent = 'Connection successful! Supabase is working correctly.';
                    resultDiv.className = 'mt-2 p-2 rounded bg-green-100 text-green-800';
                    console.log('Connection test successful:', data);
                } catch (error) {
                    resultDiv.textContent = `Connection failed: ${error.message}`;
                    resultDiv.className = 'mt-2 p-2 rounded bg-red-100 text-red-800';
                    console.error('Connection test failed:', error);
                }
            });
            
            // Test authentication
            document.getElementById('testAuth').addEventListener('click', async function() {
                const resultDiv = document.getElementById('authResult');
                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                
                if (!email || !password) {
                    resultDiv.textContent = 'Please enter both email and password';
                    resultDiv.className = 'mt-2 p-2 rounded bg-yellow-100 text-yellow-800';
                    return;
                }
                
                resultDiv.textContent = 'Testing authentication...';
                resultDiv.className = 'mt-2 p-2 rounded bg-gray-100';
                
                try {
                    const { data, error } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password
                    });
                    
                    if (error) {
                        throw error;
                    }
                    
                    resultDiv.textContent = 'Authentication successful! User is logged in.';
                    resultDiv.className = 'mt-2 p-2 rounded bg-green-100 text-green-800';
                    console.log('Authentication successful:', data);
                } catch (error) {
                    resultDiv.textContent = `Authentication failed: ${error.message}`;
                    resultDiv.className = 'mt-2 p-2 rounded bg-red-100 text-red-800';
                    console.error('Authentication failed:', error);
                }
            });
            
            // Test profile access
            document.getElementById('testProfile').addEventListener('click', async function() {
                const resultDiv = document.getElementById('profileResult');
                resultDiv.textContent = 'Testing profile access...';
                resultDiv.className = 'mt-2 p-2 rounded bg-gray-100';
                
                try {
                    // First get the current user
                    const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                    
                    if (authError) {
                        throw authError;
                    }
                    
                    if (!user) {
                        resultDiv.textContent = 'No user logged in. Please log in first.';
                        resultDiv.className = 'mt-2 p-2 rounded bg-yellow-100 text-yellow-800';
                        return;
                    }
                    
                    // Then get their profile
                    const { data: profile, error: profileError } = await supabaseClient
                        .from('profiles')
                        .select('*')
                        .eq('id', user.id)
                        .single();
                    
                    if (profileError) {
                        // If profile doesn't exist, create one
                        if (profileError.code === 'PGRST116') {
                            const { data: newProfile, error: createError } = await supabaseClient
                                .from('profiles')
                                .insert([
                                    { 
                                        id: user.id
                                    }
                                ])
                                .select()
                                .single();
                            
                            if (createError) {
                                throw createError;
                            }
                            
                            resultDiv.textContent = 'Profile created successfully! Profile structure: ' + JSON.stringify(newProfile, null, 2);
                            resultDiv.className = 'mt-2 p-2 rounded bg-green-100 text-green-800';
                            console.log('New profile created:', newProfile);
                            return;
                        }
                        throw profileError;
                    }
                    
                    resultDiv.textContent = 'Profile access successful! Profile structure: ' + JSON.stringify(profile, null, 2);
                    resultDiv.className = 'mt-2 p-2 rounded bg-green-100 text-green-800';
                    console.log('Profile test successful:', profile);
                } catch (error) {
                    resultDiv.textContent = `Profile access failed: ${error.message}`;
                    resultDiv.className = 'mt-2 p-2 rounded bg-red-100 text-red-800';
                    console.error('Profile test failed:', error);
                }
            });
        });
    </script>
</body>
</html> 