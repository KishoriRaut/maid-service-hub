<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Employer Dashboard - City Maid Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!-- Import Supabase Configuration -->
    <script type="module">
        import { supabase } from '../js/supabase-config.js';
        window.supabase = supabase; // Make it globally available
    </script>
    <!-- Khalti Checkout Script -->
    <script src="https://khalti.s3.ap-south-1.amazonaws.com/KPG/dist/2020.12.17.0/khalti-checkout.iffe.js"></script>
    <!-- Chart.js for data visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- AOS Animation Library -->
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <!-- Payment Service Script -->
    <script src="../js/payment-service.js"></script>
    <!-- Fallback Payment System -->
    <script src="../js/fallback-payment.js"></script>
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #f8fafc;
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-border {
            position: relative;
            background: linear-gradient(white, white) padding-box,
                        linear-gradient(to right, #3b82f6, #8b5cf6) border-box;
            border: 1px solid transparent;
        }
        
        .hover-scale {
            transition: transform 0.2s ease-in-out;
        }
        
        .hover-scale:hover {
            transform: scale(1.02);
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1),
                       0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: box-shadow 0.3s ease;
        }
        
        .card-shadow:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
                       0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .skill-tag {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge.active {
            background-color: #dcfce7;
            color: #166534;
        }
        
        .status-badge.pending {
            background-color: #fef9c3;
            color: #854d0e;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px -1px rgba(59, 130, 246, 0.5);
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100vh;
            background: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            z-index: 40;
            transition: all 0.3s ease;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e5e7eb;
        }

        .sidebar-nav {
            padding: 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            border-radius: 0.5rem;
            color: #4b5563;
            transition: all 0.2s ease;
        }

        .nav-item:hover {
            background: #f3f4f6;
            color: #4f46e5;
        }

        .nav-item.active {
            background: #4f46e5;
            color: white;
        }

        .nav-item i {
            width: 1.5rem;
            margin-right: 0.75rem;
        }

        .sidebar-footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .logout-btn {
            width: 100%;
            padding: 0.75rem;
            background: #ef4444;
            color: white;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .logout-btn:hover {
            background: #dc2626;
        }

        .logout-btn i {
            margin-right: 0.5rem;
        }

        /* Main content adjustment */
        .main-content {
            margin-left: 280px;
            transition: all 0.3s ease;
        }

        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }
        }
        
        /* Advanced styles */
        :root {
            --primary-color: #4f46e5;
            --primary-light: #818cf8;
            --primary-dark: #3730a3;
            --secondary-color: #10b981;
            --accent-color: #f59e0b;
            --danger-color: #ef4444;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
        }
        
        /* Glass morphism effect */
        .glass-card {
            @apply bg-white bg-opacity-80 backdrop-blur-md border border-gray-200 shadow-lg;
        }
        
        /* Gradient backgrounds */
        .gradient-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
        }
        
        .gradient-success {
            background: linear-gradient(135deg, var(--success-color), #34d399);
        }
        
        .gradient-warning {
            background: linear-gradient(135deg, var(--warning-color), #fbbf24);
        }
        
        .gradient-info {
            background: linear-gradient(135deg, var(--info-color), #60a5fa);
        }
        
        /* Card hover effects */
        .hover-card {
            @apply transition-all duration-300 ease-in-out;
        }
        
        .hover-card:hover {
            @apply transform -translate-y-1 shadow-xl;
        }
        
        /* Button animations */
        .btn-animate {
            @apply transition-all duration-300 ease-in-out;
        }
        
        .btn-animate:hover {
            @apply transform scale-105;
        }
        
        .btn-animate:active {
            @apply transform scale-95;
        }
        
        /* Pulse animation for notifications */
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        /* Shimmer loading effect */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .shimmer {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite linear;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--gray-100);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--gray-300);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--gray-400);
        }
        
        /* Existing styles remain unchanged */
        .sidebar-item {
            @apply flex items-center px-4 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-colors duration-200;
        }
        .sidebar-item.active {
            @apply bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600;
        }
        .card {
            @apply bg-white rounded-lg shadow-md overflow-hidden;
        }
        .card-header {
            @apply px-6 py-4 border-b border-gray-200;
        }
        .card-body {
            @apply p-6;
        }
        .stat-card {
            @apply bg-white rounded-lg shadow-md p-6 flex items-center;
        }
        .stat-icon {
            @apply p-3 rounded-full text-white mr-4;
        }
        
        /* Enhanced styles */
        body {
            background: linear-gradient(to bottom right, #f3f4f6, #e5e7eb);
        }
        .sidebar-item {
            @apply flex items-center px-4 py-3 text-gray-700 hover:bg-indigo-50 hover:text-indigo-600 transition-all duration-200 rounded-md mx-2 my-1;
        }
        .sidebar-item.active {
            @apply bg-indigo-50 text-indigo-600 border-r-4 border-indigo-600 shadow-sm;
        }
        .card {
            @apply bg-white rounded-xl shadow-md overflow-hidden border border-gray-100 hover:shadow-lg transition-shadow duration-300;
        }
        .stat-card {
            @apply bg-white rounded-xl shadow-md p-6 flex items-center border border-gray-100 hover:shadow-lg transition-all duration-300;
        }
        .stat-icon {
            @apply p-3 rounded-full text-white mr-4 shadow-md;
        }
        .maid-card {
            @apply bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1;
        }
        .skill-tag {
            @apply px-2 py-1 bg-indigo-50 text-indigo-600 text-xs rounded-full shadow-sm;
        }
        .btn-primary {
            @apply inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 shadow-sm transition-all duration-200;
        }
        .btn-secondary {
            @apply inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 shadow-sm transition-all duration-200;
        }
        .user-avatar {
            @apply w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-purple-600 flex items-center justify-center text-white shadow-md;
        }
        .notification-badge {
            @apply absolute top-0 right-0 block h-2 w-2 rounded-full bg-red-500 shadow-sm;
        }
        .status-badge {
            @apply inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium shadow-sm;
        }
        .status-badge-active {
            @apply bg-green-100 text-green-800;
        }
        .status-badge-inactive {
            @apply bg-gray-100 text-gray-800;
        }
        /* Additional responsive styles */
        @media (max-width: 640px) {
            .maid-card {
                @apply flex-col;
            }
            .maid-card .flex-1 {
                @apply w-full mt-4;
            }
            .stat-card {
                @apply flex-col text-center items-center;
            }
            .stat-icon {
                @apply mb-4 mr-0;
            }
            .job-actions {
                @apply flex-col space-y-2 mt-4;
            }
            .job-actions button {
                @apply w-full;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">
    <!-- Mobile Menu Button -->
    <button id="mobile-menu-button" class="fixed top-4 left-4 z-40 p-2 rounded-md bg-white shadow-md md:hidden glass-card" title="Toggle Menu">
        <i class="fas fa-bars text-gray-600"></i>
    </button>

    <!-- Overlay for mobile -->
    <div id="sidebar-overlay" class="hidden md:hidden fixed inset-0 bg-gray-600 bg-opacity-50 z-20" onclick="toggleSidebar()"></div>

    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="../index.html" class="flex items-center">
                    <span class="text-xl font-bold text-indigo-600">City Maid Services</span>
                </a>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="profile">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="#" class="nav-item" data-page="find-maids">
                    <i class="fas fa-search"></i>
                    <span>Find Maids</span>
                </a>
                <a href="#" class="nav-item" data-page="unlocked-contacts">
                    <i class="fas fa-address-book"></i>
                    <span>Unlocked Contacts</span>
                </a>
                <a href="#" class="nav-item" data-page="payment-history">
                    <i class="fas fa-credit-card"></i>
                    <span>Payment History</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sign Out</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="glass-effect sticky top-0 z-10 px-6 py-4 flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-800">Dashboard</h1>
                <div class="flex items-center space-x-4">
                    <button class="p-2 text-gray-600 hover:text-gray-800 transition-colors" aria-label="Notifications">
                        <i class="fas fa-bell text-xl"></i>
                    </button>
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white font-semibold user-initials">
                            JD
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-800 user-name">John Doe</p>
                            <p class="text-xs text-gray-500 user-email">john@example.com</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="p-6">
                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="glass-effect rounded-xl p-6 card-shadow hover-scale" data-aos="fade-up" data-aos-delay="100">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Available Maids</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1">24</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                                <i class="fas fa-user-friends text-blue-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span class="text-green-500 text-sm">
                                <i class="fas fa-arrow-up"></i> 12% increase
                            </span>
                        </div>
                    </div>

                    <div class="glass-effect rounded-xl p-6 card-shadow hover-scale" data-aos="fade-up" data-aos-delay="200">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Active Jobs</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1">8</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                                <i class="fas fa-briefcase text-purple-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span class="text-green-500 text-sm">
                                <i class="fas fa-arrow-up"></i> 3 new this week
                            </span>
                        </div>
                    </div>

                    <div class="glass-effect rounded-xl p-6 card-shadow hover-scale" data-aos="fade-up" data-aos-delay="300">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Unlocked Contacts</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1">12</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                                <i class="fas fa-address-book text-green-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span class="text-green-500 text-sm">
                                <i class="fas fa-arrow-up"></i> 2 new this month
                            </span>
                        </div>
                    </div>

                    <div class="glass-effect rounded-xl p-6 card-shadow hover-scale" data-aos="fade-up" data-aos-delay="400">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-500">Total Spent</p>
                                <h3 class="text-2xl font-bold text-gray-800 mt-1">$1,240</h3>
                            </div>
                            <div class="w-12 h-12 rounded-full bg-yellow-100 flex items-center justify-center">
                                <i class="fas fa-wallet text-yellow-500 text-xl"></i>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span class="text-gray-500 text-sm">
                                Last 30 days
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Available Maids Section -->
                <div class="mb-8" data-aos="fade-up">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-semibold text-gray-800">Available Maids</h2>
                        <button class="btn-primary">
                            <i class="fas fa-search mr-2"></i> Search Maids
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="availableMaids">
                        <!-- Maid cards will be dynamically added here -->
                    </div>
                </div>

                <!-- Job Postings Section -->
                <div class="mb-8" data-aos="fade-up">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-semibold text-gray-800">Job Postings</h2>
                        <button onclick="document.getElementById('jobPostingModal').classList.remove('hidden')"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            <svg class="mr-2 h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                            </svg>
                            Post New Job
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="jobPostings">
                        <!-- Job posting cards will be dynamically added here -->
                    </div>
                </div>

                <!-- Recent Activity Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Unlocked Contacts -->
                    <div class="glass-effect rounded-xl p-6 card-shadow" data-aos="fade-right">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Recent Unlocked Contacts</h2>
                        <div class="space-y-4" id="unlockedContacts">
                            <!-- Unlocked contact items will be dynamically added here -->
                        </div>
                    </div>

                    <!-- Payment History -->
                    <div class="glass-effect rounded-xl p-6 card-shadow" data-aos="fade-left">
                        <h2 class="text-xl font-semibold text-gray-800 mb-6">Recent Payments</h2>
                        <div class="space-y-4" id="paymentHistory">
                            <!-- Payment history items will be dynamically added here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Posting Modal -->
    <div id="jobPostingModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <h3 class="text-lg font-medium leading-6 text-gray-900 mb-4">Post a New Job</h3>
                <form id="jobPostingForm" onsubmit="saveJobPosting(event)" class="space-y-4">
                    <div>
                        <label for="job-title" class="block text-sm font-medium text-gray-700">Job Title</label>
                        <input type="text" id="job-title" name="job-title" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="job-location" class="block text-sm font-medium text-gray-700">Location</label>
                        <input type="text" id="job-location" name="job-location" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="job-budget" class="block text-sm font-medium text-gray-700">Budget (Rs.)</label>
                        <input type="number" id="job-budget" name="job-budget" required min="0"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="job-type" class="block text-sm font-medium text-gray-700">Job Type</label>
                        <select id="job-type" name="job-type" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                            <option value="full-time">Full Time</option>
                            <option value="part-time">Part Time</option>
                            <option value="contract">Contract</option>
                        </select>
                    </div>
                    <div>
                        <label for="work-hours" class="block text-sm font-medium text-gray-700">Work Hours</label>
                        <input type="text" id="work-hours" name="work-hours" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                            placeholder="e.g., 9 AM - 5 PM">
                    </div>
                    <div>
                        <label for="start-date" class="block text-sm font-medium text-gray-700">Start Date</label>
                        <input type="date" id="start-date" name="start-date" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm">
                    </div>
                    <div>
                        <label for="job-description" class="block text-sm font-medium text-gray-700">Job Description</label>
                        <textarea id="job-description" name="job-description" rows="3" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
                    </div>
                    <div>
                        <label for="required-skills" class="block text-sm font-medium text-gray-700">Required Skills</label>
                        <input type="text" id="required-skills" name="required-skills" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"
                            placeholder="e.g., Cleaning, Cooking, Childcare">
                    </div>
                    <div>
                        <label for="additional-requirements" class="block text-sm font-medium text-gray-700">Additional Requirements</label>
                        <textarea id="additional-requirements" name="additional-requirements" rows="2"
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm"></textarea>
                    </div>
                    <div class="flex justify-end space-x-3">
                        <button type="button" onclick="document.getElementById('jobPostingModal').classList.add('hidden')"
                            class="inline-flex items-center px-4 py-2 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Cancel
                        </button>
                        <button type="submit" id="submitJobBtn"
                            class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Post Job
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white p-8 rounded-lg shadow-xl text-center">
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
            <p class="mt-4 text-gray-700">Loading dashboard...</p>
        </div>
    </div>

    <script>
        // Initialize AOS
        AOS.init({
            duration: 800,
            once: true,
            offset: 100
        });

        // Show loading state
        function showLoading() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.add('hidden');
        }

        // Wait for Supabase to be loaded
        function waitForSupabase() {
            return new Promise((resolve) => {
                if (window.supabase) {
                    resolve(window.supabase);
                } else {
                    const checkSupabase = setInterval(() => {
                        if (window.supabase) {
                            clearInterval(checkSupabase);
                            resolve(window.supabase);
                        }
                    }, 100);
                }
            });
        }

        // Initialize dashboard
        async function initializeDashboard() {
            showLoading();
            try {
                // Wait for Supabase to be available
                const supabase = await waitForSupabase();
                console.log('Supabase client loaded');

                // Check if user is authenticated
                const { data: { session }, error: sessionError } = await supabase.auth.getSession();
                
                if (sessionError || !session) {
                    console.log('No session found, redirecting to login');
                    window.location.href = '../auth/login.html';
                    return;
                }

                // Check if user is an employer
                const userRole = session.user.user_metadata.role;
                if (userRole !== 'employer') {
                    console.log('User is not an employer, redirecting to login');
                    window.location.href = '../auth/login.html';
                    return;
                }
                
                console.log('Employer authenticated:', session.user);
                
                // Update user info in the header
                const userName = session.user.user_metadata.full_name || session.user.email.split('@')[0];
                const userInitials = userName.split(' ').map(n => n[0]).join('').toUpperCase();
                
                document.querySelector('.user-initials').textContent = userInitials;
                document.querySelector('.user-name').textContent = userName;
                document.querySelector('.user-email').textContent = session.user.email;
                
                // Load initial content
                await loadDashboardContent();
                
                // Add event listeners
                const logoutBtn = document.getElementById('logoutBtn');
                if (logoutBtn) {
                    logoutBtn.addEventListener('click', async () => {
                        showLoading();
                        const { error } = await supabase.auth.signOut();
                        if (error) {
                            console.error('Error signing out:', error);
                            hideLoading();
                        } else {
                            window.location.href = '../auth/login.html';
                        }
                    });
                }
                
                // Add click handlers to sidebar menu items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', () => {
                        const page = item.getAttribute('data-page');
                        if (page) {
                            navigateTo(page);
                        }
                    });
                });

                // Initialize mobile menu
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                if (mobileMenuButton) {
                    mobileMenuButton.addEventListener('click', toggleSidebar);
                }

            } catch (error) {
                console.error('Error initializing dashboard:', error);
                window.location.href = '../auth/login.html';
            } finally {
                hideLoading();
            }
        }

        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', () => {
            // Start initialization process
            initializeDashboard().catch(error => {
                console.error('Failed to initialize dashboard:', error);
                window.location.href = '../auth/login.html';
            });
        });

        // Function to show toast messages
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center space-x-2 ${
                type === 'success' ? 'bg-green-500' : 'bg-red-500'
            } text-white`;
            toast.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);
            setTimeout(() => {
                toast.remove();
            }, 3000);
        }

        // Function to save job posting
        async function saveJobPosting(event) {
            event.preventDefault();
            console.log('Saving job posting...');
            
            const submitButton = document.getElementById('submitJobBtn');
            const originalButtonText = submitButton.innerHTML;
            
            try {
                // Show loading state
                submitButton.disabled = true;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Saving...';
                
                // Get form data
                const formData = {
                    title: document.getElementById('job-title').value,
                    location: document.getElementById('job-location').value,
                    budget: parseFloat(document.getElementById('job-budget').value),
                    type: document.getElementById('job-type').value,
                    work_hours: document.getElementById('work-hours').value,
                    start_date: document.getElementById('start-date').value,
                    description: document.getElementById('job-description').value,
                    required_skills: document.getElementById('required-skills').value.split(',').map(skill => skill.trim()),
                    additional_requirements: document.getElementById('additional-requirements').value,
                    status: 'active',
                    applicants_count: 0
                };
                
                console.log('Form data:', formData);
                
                // Get current user
                const { data: { user }, error: userError } = await supabase.auth.getUser();
                if (userError) {
                    console.error('User auth error:', userError);
                    throw userError;
                }
                
                if (!user) {
                    console.error('No user found');
                    throw new Error('You must be logged in to post a job');
                }
                
                // Add employer_id to form data
                formData.employer_id = user.id;
                
                console.log('Saving to Supabase...');
                
                // Save to Supabase
                const { data, error } = await supabase
                    .from('job_postings')
                    .insert([formData]);
                    
                if (error) {
                    console.error('Supabase error:', error);
                    throw error;
                }
                
                console.log('Job posting saved successfully:', data);
                
                // Show success message
                showToast('Job posted successfully!', 'success');
                
                // Close modal and reset form
                document.getElementById('jobPostingModal').classList.add('hidden');
                document.getElementById('jobPostingForm').reset();
                
                // Reload job postings
                loadJobPostings();
                
            } catch (error) {
                console.error('Error saving job posting:', error);
                showToast(error.message || 'Error saving job posting', 'error');
            } finally {
                // Reset button state
                submitButton.disabled = false;
                submitButton.innerHTML = originalButtonText;
            }
        }

        // Function to load job postings
        async function loadJobPostings() {
            try {
                const { data: { user }, error: userError } = await supabase.auth.getUser();
                if (userError) throw userError;

                const { data: jobs, error } = await supabase
                    .from('job_postings')
                    .select('*')
                    .eq('employer_id', user.id)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                const jobsContainer = document.getElementById('job-postings-container');
                if (!jobsContainer) return;

                if (jobs.length === 0) {
                    jobsContainer.innerHTML = `
                        <div class="text-center py-8">
                            <i class="fas fa-briefcase text-4xl text-gray-400 mb-4"></i>
                            <p class="text-gray-500">No job postings yet</p>
                        </div>
                    `;
                    return;
                }

                jobsContainer.innerHTML = jobs.map(job => `
                    <div class="bg-white rounded-lg shadow-sm p-6 hover:shadow-md transition-shadow duration-200" data-aos="fade-up">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-semibold text-gray-900">${job.title}</h3>
                                <p class="text-gray-600 mt-1">${job.location}</p>
                            </div>
                            <span class="px-3 py-1 rounded-full text-sm font-medium ${
                                job.status === 'active' ? 'bg-green-100 text-green-800' :
                                job.status === 'filled' ? 'bg-blue-100 text-blue-800' :
                                'bg-gray-100 text-gray-800'
                            }">
                                ${job.status.charAt(0).toUpperCase() + job.status.slice(1)}
                            </span>
                        </div>
                        <div class="mt-4 grid grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm text-gray-500">Budget</p>
                                <p class="font-medium">Rs. ${job.budget.toLocaleString()}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Type</p>
                                <p class="font-medium">${job.job_type}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Work Hours</p>
                                <p class="font-medium">${job.work_hours}</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500">Start Date</p>
                                <p class="font-medium">${new Date(job.start_date).toLocaleDateString()}</p>
                            </div>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-500">Description</p>
                            <p class="text-gray-700 mt-1">${job.job_description}</p>
                        </div>
                        <div class="mt-4">
                            <p class="text-sm text-gray-500">Required Skills</p>
                            <div class="flex flex-wrap gap-2 mt-1">
                                ${job.required_skills.map(skill => `
                                    <span class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-sm">
                                        ${skill}
                                    </span>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mt-6 flex justify-end space-x-3">
                            <button onclick="editJob('${job.id}')" class="text-brand-primary hover:text-brand-secondary">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button onclick="deleteJob('${job.id}')" class="text-red-600 hover:text-red-700">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');

            } catch (error) {
                console.error('Error loading jobs:', error);
                showToast('Error loading job postings. Please try again.', 'error');
            }
        }

        // Function to edit job
        async function editJob(jobId) {
            try {
                const { data: job, error } = await supabase
                    .from('job_postings')
                    .select('*')
                    .eq('id', jobId)
                    .single();

                if (error) throw error;

                // Populate form with job data
                const form = document.getElementById('jobPostingForm');
                form.querySelector('#job-title').value = job.title;
                form.querySelector('#job-location').value = job.location;
                form.querySelector('#job-budget').value = job.budget;
                form.querySelector('#job-type').value = job.job_type;
                form.querySelector('#work-hours').value = job.work_hours;
                form.querySelector('#start-date').value = job.start_date;
                form.querySelector('#job-description').value = job.job_description;
                form.querySelector('#required-skills').value = job.required_skills.join(', ');
                form.querySelector('#additional-requirements').value = job.additional_requirements;

                // Show modal
                form.closest('.modal').classList.remove('hidden');

                // Update form submission handler
                form.onsubmit = async (e) => {
                    e.preventDefault();
                    const submitButton = form.querySelector('button[type="submit"]');
                    const originalButtonText = submitButton.innerHTML;
                    
                    try {
                        submitButton.disabled = true;
                        submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';

                        const formData = {
                            title: form.querySelector('#job-title').value,
                            location: form.querySelector('#job-location').value,
                            budget: parseFloat(form.querySelector('#job-budget').value),
                            job_type: form.querySelector('#job-type').value,
                            work_hours: form.querySelector('#work-hours').value,
                            start_date: form.querySelector('#start-date').value,
                            job_description: form.querySelector('#job-description').value,
                            required_skills: form.querySelector('#required-skills').value.split(',').map(skill => skill.trim()),
                            additional_requirements: form.querySelector('#additional-requirements').value
                        };

                        const { error: updateError } = await supabase
                            .from('job_postings')
                            .update(formData)
                            .eq('id', jobId);

                        if (updateError) throw updateError;

                        showToast('Job updated successfully!', 'success');
                        form.closest('.modal').classList.add('hidden');
                        loadJobPostings();

                    } catch (error) {
                        console.error('Error updating job:', error);
                        showToast('Error updating job. Please try again.', 'error');
                    } finally {
                        submitButton.disabled = false;
                        submitButton.innerHTML = originalButtonText;
                    }
                };

            } catch (error) {
                console.error('Error loading job for edit:', error);
                showToast('Error loading job details. Please try again.', 'error');
            }
        }

        // Function to delete job
        async function deleteJob(jobId) {
            if (!confirm('Are you sure you want to delete this job posting?')) return;

            try {
                const { error } = await supabase
                    .from('job_postings')
                    .delete()
                    .eq('id', jobId);

                if (error) throw error;

                showToast('Job deleted successfully!', 'success');
                loadJobPostings();

            } catch (error) {
                console.error('Error deleting job:', error);
                showToast('Error deleting job. Please try again.', 'error');
            }
        }

        // Current page state
        let currentPage = 'dashboard';

        // Handle navigation
        function navigateTo(page) {
            // Update active state in sidebar
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`).classList.add('active');

            // Hide all content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.add('hidden');
            });

            // Show selected content section
            const selectedSection = document.getElementById(`${page}Section`);
            if (selectedSection) {
                selectedSection.classList.remove('hidden');
            }

            // Update current page
            currentPage = page;

            // Load page specific content
            switch(page) {
                case 'dashboard':
                    loadDashboardContent();
                    break;
                case 'profile':
                    loadProfileContent();
                    break;
                case 'find-maids':
                    loadAvailableMaids();
                    break;
                case 'job-postings':
                    loadJobPostings();
                    break;
                case 'unlocked-contacts':
                    loadUnlockedContacts();
                    break;
                case 'payment-history':
                    loadPaymentHistory();
                    break;
                case 'settings':
                    loadSettingsContent();
                    break;
            }
        }

        // Load dashboard content
        function loadDashboardContent() {
            loadAvailableMaids();
            loadJobPostings();
            loadPaymentHistory();
        }

        // Load profile content
        function loadProfileContent() {
            const container = document.getElementById('profileSection');
            if (!container) return;

            container.innerHTML = `
                <div class="glass-effect rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Profile Information</h2>
                    <div class="space-y-4">
                        <div class="flex items-center space-x-4">
                            <div class="w-20 h-20 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white text-2xl font-bold">
                                JD
                            </div>
                            <div>
                                <h3 class="text-lg font-medium text-gray-800">John Doe</h3>
                                <p class="text-gray-500">john@example.com</p>
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-500">Phone</p>
                                <p class="text-gray-800">+1 234 567 8900</p>
                            </div>
                            <div class="p-4 bg-gray-50 rounded-lg">
                                <p class="text-sm text-gray-500">Location</p>
                                <p class="text-gray-800">New York, USA</p>
                            </div>
                        </div>
                        <button class="btn-primary">
                            <i class="fas fa-edit mr-2"></i> Edit Profile
                        </button>
                    </div>
                </div>
            `;
        }

        // Load unlocked contacts
        function loadUnlockedContacts() {
            const container = document.getElementById('unlockedContactsSection');
            if (!container) return;

            const unlockedContacts = mockMaids.filter(maid => maid.unlocked);
            container.innerHTML = unlockedContacts.map((contact, index) => `
                <div class="glass-effect rounded-xl p-6 card-shadow hover-scale" data-aos="fade-up" data-aos-delay="${index * 100}">
                    <div class="flex items-center space-x-4">
                        <img src="${contact.image}" alt="${contact.name}" class="w-16 h-16 rounded-full object-cover">
                        <div class="flex-1">
                            <h3 class="text-lg font-semibold text-gray-800">${contact.name}</h3>
                            <p class="text-gray-500">Unlocked on ${contact.unlockedDate}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button class="btn-secondary">
                                <i class="fas fa-envelope"></i>
                            </button>
                            <button class="btn-secondary">
                                <i class="fas fa-phone"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Load settings content
        function loadSettingsContent() {
            const container = document.getElementById('settingsSection');
            if (!container) return;

            container.innerHTML = `
                <div class="glass-effect rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Account Settings</h2>
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Notifications</h3>
                            <div class="space-y-4">
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                                    <span class="ml-2 text-gray-700">Email notifications</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                                    <span class="ml-2 text-gray-700">SMS notifications</span>
                                </label>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-medium text-gray-800 mb-4">Privacy</h3>
                            <div class="space-y-4">
                                <label class="flex items-center">
                                    <input type="checkbox" class="form-checkbox h-5 w-5 text-indigo-600" checked>
                                    <span class="ml-2 text-gray-700">Show profile to maids</span>
                                </label>
                            </div>
                        </div>
                        <button class="btn-primary">
                            <i class="fas fa-save mr-2"></i> Save Changes
                        </button>
                    </div>
                </div>
            `;
        }

        // Mobile menu functionality
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (sidebar && overlay) {
                sidebar.classList.toggle('open');
                if (sidebar.classList.contains('open')) {
                    overlay.classList.remove('hidden');
                    document.body.style.overflow = 'hidden';
                } else {
                    overlay.classList.add('hidden');
                    document.body.style.overflow = '';
                }
            }
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.querySelector('.sidebar');
            const mobileMenuButton = document.getElementById('mobile-menu-button');
            
            if (window.innerWidth <= 768 && 
                sidebar && 
                mobileMenuButton && 
                !sidebar.contains(event.target) && 
                !mobileMenuButton.contains(event.target) &&
                sidebar.classList.contains('open')) {
                toggleSidebar();
            }
        });

        // Handle window resize
        window.addEventListener('resize', function() {
            const sidebar = document.querySelector('.sidebar');
            const overlay = document.getElementById('sidebar-overlay');
            
            if (sidebar && overlay && window.innerWidth > 768) {
                sidebar.classList.remove('open');
                overlay.classList.add('hidden');
                document.body.style.overflow = '';
            }
        });
    </script>
</body>
</html> 