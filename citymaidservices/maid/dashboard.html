<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maid Dashboard - City Maid Services</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
</head>
<body class="bg-gray-100">
    <div class="min-h-screen flex flex-col">
        <!-- Navigation -->
        <nav class="bg-white shadow-md">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <a href="../index.html" class="flex items-center">
                            <span class="text-xl font-bold text-gray-800">City Maid Services</span>
                        </a>
                    </div>
                    <div class="flex items-center space-x-4">
                        <span id="userName" class="text-gray-700"></span>
                        <button id="logoutBtn" class="px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-red-600 hover:bg-red-700">
                            Sign Out
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-grow py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-7xl mx-auto space-y-8">
                <!-- Profile Section -->
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6 flex justify-between items-center">
                        <div>
                            <h3 class="text-lg leading-6 font-medium text-gray-900">Profile Information</h3>
                            <p class="mt-1 max-w-2xl text-sm text-gray-500">Your personal and professional details.</p>
                        </div>
                        <a href="edit-profile.html" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                            Edit Profile
                        </a>
                    </div>
                    <div class="border-t border-gray-200">
                        <dl>
                            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Full name</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="fullName">Loading...</dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Email address</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="email">Loading...</dd>
                            </div>
                            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Phone number</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="phone">Loading...</dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Address</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="address">Loading...</dd>
                            </div>
                            <div class="bg-gray-50 px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Experience</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="experience">Loading...</dd>
                            </div>
                            <div class="bg-white px-4 py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6">
                                <dt class="text-sm font-medium text-gray-500">Skills</dt>
                                <dd class="mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2" id="skills">Loading...</dd>
                            </div>
                        </dl>
                    </div>
                </div>

                <!-- Job Opportunities Section -->
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Job Opportunities</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Available jobs that match your profile.</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <div id="jobListings" class="divide-y divide-gray-200">
                            <!-- Job listings will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Unlocked Contacts Section -->
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Unlocked Contacts</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Employers who have unlocked your contact information.</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <div id="unlockedContacts" class="divide-y divide-gray-200">
                            <!-- Unlocked contacts will be inserted here -->
                        </div>
                    </div>
                </div>

                <!-- Payment History Section -->
                <div class="bg-white shadow overflow-hidden sm:rounded-lg">
                    <div class="px-4 py-5 sm:px-6">
                        <h3 class="text-lg leading-6 font-medium text-gray-900">Payment History</h3>
                        <p class="mt-1 max-w-2xl text-sm text-gray-500">Your recent payments and transactions.</p>
                    </div>
                    <div class="border-t border-gray-200">
                        <div id="paymentHistory" class="divide-y divide-gray-200">
                            <!-- Payment history will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://fdgqqxyyofjnkhswkwcq.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZkZ3FxeHl5b2Zqbmtoc3drd2NxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDQwMjQyMTMsImV4cCI6MjA1OTYwMDIxM30.YyJLLu3r2a7Mh7ny0ie-YzzLfPh5PdrJJHnBFBxWqVE';
        const supabaseClient = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Check authentication and user type
        async function checkAuth() {
            try {
                // Check if user is logged in
                const { data: { user }, error: authError } = await supabaseClient.auth.getUser();
                if (authError || !user) {
                    window.location.href = '../auth/login.html';
                    return;
                }

                // Check user type
                const userType = localStorage.getItem('userType');
                if (userType !== 'maid') {
                    window.location.href = '../auth/select-type.html';
                    return;
                }

                // Get user metadata
                const metadata = user.user_metadata || {};

                // Update UI with user info
                document.getElementById('userName').textContent = metadata.full_name || 'Maid';
                document.getElementById('fullName').textContent = metadata.full_name || 'Not set';
                document.getElementById('email').textContent = user.email || 'Not set';
                document.getElementById('phone').textContent = metadata.phone || 'Not set';
                document.getElementById('address').textContent = metadata.address || 'Not set';
                document.getElementById('experience').textContent = metadata.experience_years ? `${metadata.experience_years} years` : 'Not set';
                document.getElementById('skills').textContent = metadata.skills || 'Not set';

                // Load job opportunities
                loadJobOpportunities();
                // Load unlocked contacts
                loadUnlockedContacts();
                // Load payment history
                loadPaymentHistory();
            } catch (error) {
                console.error('Auth check error:', error);
                window.location.href = '../auth/login.html';
            }
        }

        // Load job opportunities
        async function loadJobOpportunities() {
            try {
                // Mock job data since we don't have a job_postings table yet
                const mockJobs = [
                    {
                        id: '1',
                        title: 'House Cleaning - Weekly',
                        description: 'Looking for a reliable house cleaner for weekly cleaning of a 3-bedroom apartment.',
                        location: 'Downtown',
                        schedule: 'Every Saturday, 9 AM - 2 PM',
                        created_at: new Date().toISOString()
                    },
                    {
                        id: '2',
                        title: 'Elderly Care - Part-time',
                        description: 'Need assistance with elderly parent, including light housekeeping and companionship.',
                        location: 'Westside',
                        schedule: 'Monday, Wednesday, Friday, 10 AM - 3 PM',
                        created_at: new Date(Date.now() - 86400000).toISOString() // 1 day ago
                    },
                    {
                        id: '3',
                        title: 'Deep Cleaning - One-time',
                        description: 'One-time deep cleaning of a 4-bedroom house before a party.',
                        location: 'Uptown',
                        schedule: 'Next Saturday, 8 AM - 6 PM',
                        created_at: new Date(Date.now() - 172800000).toISOString() // 2 days ago
                    }
                ];

                const jobListingsDiv = document.getElementById('jobListings');
                jobListingsDiv.innerHTML = mockJobs.length ? '' : '<p class="p-4 text-gray-500">No job opportunities available.</p>';

                mockJobs.forEach(job => {
                    const jobElement = document.createElement('div');
                    jobElement.className = 'p-4 hover:bg-gray-50';
                    jobElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-lg font-medium text-gray-900">${job.title}</h4>
                                <p class="text-sm text-gray-500">${job.description}</p>
                                <div class="mt-2 text-sm text-gray-500">
                                    <span class="mr-4">Location: ${job.location}</span>
                                    <span>Schedule: ${job.schedule}</span>
                                </div>
                            </div>
                            <button onclick="viewJobDetails('${job.id}')" 
                                class="inline-flex items-center px-3 py-1 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                                View Details
                            </button>
                        </div>
                    `;
                    jobListingsDiv.appendChild(jobElement);
                });
            } catch (error) {
                console.error('Error loading job opportunities:', error);
            }
        }

        // Load unlocked contacts
        async function loadUnlockedContacts() {
            try {
                // Mock contacts data since we don't have an unlocked_contacts table yet
                const mockContacts = [
                    {
                        id: '1',
                        employer: {
                            full_name: 'John Smith',
                            email: 'john.smith@example.com',
                            phone: '(555) 123-4567'
                        },
                        unlocked_at: new Date(Date.now() - 259200000).toISOString() // 3 days ago
                    },
                    {
                        id: '2',
                        employer: {
                            full_name: 'Sarah Johnson',
                            email: 'sarah.j@example.com',
                            phone: '(555) 987-6543'
                        },
                        unlocked_at: new Date(Date.now() - 604800000).toISOString() // 1 week ago
                    }
                ];

                const contactsDiv = document.getElementById('unlockedContacts');
                contactsDiv.innerHTML = mockContacts.length ? '' : '<p class="p-4 text-gray-500">No unlocked contacts yet.</p>';

                mockContacts.forEach(contact => {
                    const contactElement = document.createElement('div');
                    contactElement.className = 'p-4 hover:bg-gray-50';
                    contactElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-lg font-medium text-gray-900">${contact.employer.full_name}</h4>
                                <p class="text-sm text-gray-500">Email: ${contact.employer.email}</p>
                                <p class="text-sm text-gray-500">Phone: ${contact.employer.phone}</p>
                                <p class="text-sm text-gray-500">Unlocked: ${new Date(contact.unlocked_at).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                    contactsDiv.appendChild(contactElement);
                });
            } catch (error) {
                console.error('Error loading unlocked contacts:', error);
            }
        }

        // Load payment history
        async function loadPaymentHistory() {
            try {
                // Mock payments data since we don't have a payments table yet
                const mockPayments = [
                    {
                        id: '1',
                        amount: 50.00,
                        created_at: new Date(Date.now() - 259200000).toISOString(), // 3 days ago
                        status: 'Completed'
                    },
                    {
                        id: '2',
                        amount: 75.00,
                        created_at: new Date(Date.now() - 604800000).toISOString(), // 1 week ago
                        status: 'Completed'
                    },
                    {
                        id: '3',
                        amount: 100.00,
                        created_at: new Date(Date.now() - 1209600000).toISOString(), // 2 weeks ago
                        status: 'Completed'
                    }
                ];

                const paymentsDiv = document.getElementById('paymentHistory');
                paymentsDiv.innerHTML = mockPayments.length ? '' : '<p class="p-4 text-gray-500">No payment history available.</p>';

                mockPayments.forEach(payment => {
                    const paymentElement = document.createElement('div');
                    paymentElement.className = 'p-4 hover:bg-gray-50';
                    paymentElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="text-lg font-medium text-gray-900">Payment #${payment.id}</h4>
                                <p class="text-sm text-gray-500">Amount: $${payment.amount.toFixed(2)}</p>
                                <p class="text-sm text-gray-500">Date: ${new Date(payment.created_at).toLocaleDateString()}</p>
                                <p class="text-sm text-gray-500">Status: ${payment.status}</p>
                            </div>
                        </div>
                    `;
                    paymentsDiv.appendChild(paymentElement);
                });
            } catch (error) {
                console.error('Error loading payment history:', error);
            }
        }

        // Handle sign out
        async function handleSignOut() {
            try {
                const { error } = await supabaseClient.auth.signOut();
                if (error) throw error;
                
                // Clear user type from localStorage
                localStorage.removeItem('userType');
                
                // Redirect to login
                window.location.href = '../auth/login.html';
            } catch (error) {
                console.error('Sign out error:', error);
            }
        }

        // View job details
        function viewJobDetails(jobId) {
            window.location.href = `view-job.html?id=${jobId}`;
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listener for logout button
            document.getElementById('logoutBtn').addEventListener('click', handleSignOut);
            
            // Check authentication and load data
            checkAuth();
        });
    </script>
</body>
</html> 